تقرير توثيق البنية التحتية لـ Supabase - مشروع Exclusive Ecommerce
مقدمة: هذا التقرير يوضح بالتفصيل هيكل قاعدة البيانات، العلاقات بين الجداول، وسياسات الأمان التي تم إعدادها في Supabase. الهدف هو تزويد مطور الواجهة الأمامية بالمعرفة اللازمة لإنشاء دوال API فعالة وآمنة للتفاعل مع البيانات.

1. مصادقة المستخدمين (User Authentication)
النظام: يتم الاعتماد بشكل كامل على نظام Supabase Authentication المدمج.

جدول المستخدمين: يقوم Supabase بإدارة جدول users داخل auth schema تلقائيًا. يحتوي هذا الجدول على معلومات المستخدمين الأساسية مثل id (من نوع uuid)، email، إلخ.

ملاحظة للمطور: لا تحتاج إلى التعامل المباشر مع هذا الجدول. ستستخدم دوال Supabase JS Client مثل supabase.auth.signUp() و supabase.auth.signInWithPassword() للتسجيل والدخول، ودالة supabase.auth.getUser() للحصول على بيانات المستخدم الحالي.

2. كتالوج المنتجات (products Table)
الغرض: هذا الجدول هو المصدر الأساسي لجميع المنتجات المعروضة في المتجر.

هيكل الأعمدة الرئيسي:

id (int8): المعرّف الفريد للمنتج.

title (text): اسم المنتج.

price (numeric): السعر الحالي.

img (text): رابط صورة المنتج.

... وأي أعمدة أخرى خاصة بتفاصيل المنتج (rating, category, etc.).

3. خاصية قائمة المفضلة (Wishlist Feature)
تم بناء هذه الخاصية باستخدام جدول واحد مؤمن بسياسات RLS صارمة.

جدول wishlist:

الغرض: يعمل كجدول ربط لتسجيل المنتجات التي يضيفها كل مستخدم إلى مفضلته.

الأعمدة:

id (int8): مفتاح أساسي.

user_id (uuid): مفتاح أجنبي يرتبط بـ auth.users.id.

product_id (int8): مفتاح أجنبي يرتبط بـ products.id.

created_at (timestamptz): تاريخ الإضافة.

سياسات الأمان (RLS):

القاعدة: المستخدم المسجل يمكنه فقط عرض، إضافة، وحذف العناصر من قائمته الخاصة فقط. لا يمكن لأي مستخدم الوصول لبيانات مستخدم آخر.

التطبيق: تم تطبيق سياسات SELECT, INSERT, DELETE بشرط auth.uid() = user_id.

4. خاصية الطلبات والدفع (Orders & Checkout Feature)
تم بناء هذه الخاصية باستخدام تصميم احترافي مكون من جدولين لضمان تخزين كافة تفاصيل الطلبات بشكل صحيح.

جدول orders:

الغرض: تخزين المعلومات العامة للطلب.

الأعمدة:

id (int8): رقم الطلب الفريد (مفتاح أساسي).

user_id (uuid): مفتاح أجنبي يرتبط بـ auth.users.id.

total_price (numeric): السعر الإجمالي للطلب.

shipping_address (jsonb): لتخزين عنوان الشحن ككائن JSON.

status (text): حالة الطلب (القيمة الافتراضية: 'pending').

created_at (timestamptz): تاريخ إنشاء الطلب.

جدول order_items:

الغرض: تخزين تفاصيل المنتجات داخل كل طلب على حدة.

الأعمدة:

id (int8): مفتاح أساسي.

order_id (int8): مفتاح أجنبي يرتبط بـ orders.id.

product_id (int8): مفتاح أجنبي يرتبط بـ products.id.

quantity (int4): كمية المنتج المطلوب.

price_at_purchase (numeric): سعر المنتج في لحظة الشراء لضمان دقة السجلات.

سياسات الأمان (RLS):

جدول orders: المستخدم يمكنه فقط عرض (SELECT) و إنشاء (INSERT) الطلبات الخاصة به.

جدول order_items: المستخدم يمكنه فقط عرض (SELECT) و إضافة (INSERT) العناصر التي تنتمي إلى طلب يملكه هو. تم تحقيق ذلك باستخدام استعلام فرعي (EXISTS) للتحقق من ملكية الطلب الرئيسي.

خلاصة لمطور الواجهة الأمامية: لقد تم تجهيز قاعدة البيانات ببنية آمنة وقوية. عند كتابة دوال الـ API، يمكنك الاطمئنان إلى أن Supabase سيفرض قواعد الخصوصية هذه على مستوى قاعدة البيانات. مهمتك هي كتابة الدوال التي تقوم بعمليات select, insert, delete على هذه الجداول، مع تمرير بيانات المستخدم والمنتجات المطلوبة.